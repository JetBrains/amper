{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "/deft/dsl",
  "title": "Deft DSL",
  "type": "object",
  "properties": {
    "include": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "type": "string"
      }
    },
    "product": {
      "type": "object",
      "properties": {
        "type": {
          "enum": [
            "app",
            "lib"
          ]
        },
        "platforms": {
          "$ref": "#/$defs/platformList"
        }
      },
      "required": [
        "type",
        "platforms"
      ]
    },
    "aliases": {
      "type": "object",
      "patternProperties": {
        "^[^@+:]+$": {
          "$ref": "#/$defs/platformList"
        }
      }
    },
    "variants": {
      "type": "array",
      "items": {
        "oneOf": [
          {
            "type": "string"
          },
          {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        ]
      }
    },
    "dependencies": {
      "$ref": "#/$defs/dependencyList"
    },
    "dependencies@jvm": {
      "$ref": "#/$defs/dependencyList"
    },
    "dependencies@android": {
      "$ref": "#/$defs/dependencyList"
    },
    "dependencies@ios": {
      "$ref": "#/$defs/dependencyList"
    },
    "test-dependencies": {
      "$ref": "#/$defs/dependencyList"
    },
    "test-dependencies@jvm": {
      "$ref": "#/$defs/dependencyList"
    },
    "test-dependencies@android": {
      "$ref": "#/$defs/dependencyList"
    },
    "test-dependencies@ios": {
      "$ref": "#/$defs/dependencyList"
    },
    "settings": {
      "$ref": "#/$defs/settings"
    },
    "settings@jvm": {
      "$ref": "#/$defs/settings"
    },
    "settings@android": {
      "$ref": "#/$defs/settings"
    },
    "settings@ios": {
      "$ref": "#/$defs/settings"
    },
    "test-settings": {
      "$ref": "#/$defs/settings"
    },
    "test-settings@jvm": {
      "$ref": "#/$defs/settings"
    },
    "test-settings@android": {
      "$ref": "#/$defs/settings"
    },
    "test-settings@ios": {
      "$ref": "#/$defs/settings"
    }
  },
  "patternProperties": {
    "^(test-)?dependencies(@.+)?$": {
      "$ref": "#/$defs/dependencyList"
    },
    "^(test-)?settings(@.+)?$": {
      "$ref": "#/$defs/settings"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "platform": {
      "enum": [
        "js",
        "jvm",
        "wasm",
        "android",
        "linuxX64",
        "linuxArm64",
        "tvosArm64",
        "tvosX64",
        "tvosSimulatorArm64",
        "macosX64",
        "macosArm64",
        "iosArm64",
        "iosX64",
        "iosSimulatorArm64",
        "watchosArm64",
        "watchosArm32",
        "watchosDeviceArm64",
        "watchosSimulatorArm64",
        "mingwX64",
        "androidNativeArm32",
        "androidNativeArm64",
        "androidNativeX64",
        "androidNativeX86"
      ]
    },
    "platformList": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "$ref": "#/$defs/platform"
      }
    },
    "dependency": {
      "type": "string"
    },
    "dependencyList": {
      "type": ["array", "null"],
      "uniqueItems": true,
      "items": {
        "$ref": "#/$defs/dependency"
      }
    },
    "settings": {
      "type": "object",
      "properties": {
        "kotlin": {
          "$ref": "#/$defs/kotlinSettings"
        },
        "java": {
          "$ref": "#/$defs/javaSettings"
        },
        "android": {
          "$ref": "#/$defs/androidSettings"
        },
        "publishing": {
          "$ref": "#/$defs/publishingSettings"
        },
        "junit": {
          "$ref": "#/$defs/junitSettings"
        }
      },
      "additionalProperties": false
    },
    "javaSettings": {
      "type": "object",
      "properties": {
        "mainClass": {
          "type": "string"
        },
        "packagePrefix": {
          "type": "string"
        },
        "jvmTarget": {
          "$ref": "#/$defs/kotlinJvmVersion"
        }
      },
      "additionalProperties": false
    },
    "javaVersion": {
      "$comment": "This version is mapped to org.gradle.api.JavaVersion",
      "$comment": "Not using 'integer' with range for proper completion in IntelliJ",
      "enum": [
        1.1,
        1.2,
        1.3,
        1.4,
        1.5,
        1.6,
        1.7,
        1.8,
        1.9,
        1.10,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24
      ]
    },
    "kotlinJvmVersion": {
      "$comment": "This version is mapped to org.jetbrains.kotlin.gradle.dsl.JvmTarget, so it contains only JVM version compatible with Kotlin compiler",
      "$comment": "Not using 'integer' with range for proper completion in IntelliJ",
      "enum": [
        1.8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19
      ]
    },
    "kotlinSettings": {
      "type": "object",
      "properties": {
        "sdk": {
          "type": "object",
          "properties": {
            "version": {
              "type": "string"
            }
          }
        },
        "progressiveMode": {
          "type": "boolean"
        },
        "languageVersion": {
          "$ref": "#/$defs/kotlinVersion"
        },
        "apiVersion": {
          "$ref": "#/$defs/kotlinVersion"
        },
        "features": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/kotlinLanguageFeature"
          }
        },
        "optIns": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "kotlinVersion": {
      "enum": [
        1.0,
        1.1,
        1.2,
        1.3,
        1.4,
        1.5,
        1.6,
        1.7,
        1.8,
        1.9,
        2.0
      ]
    },
    "kotlinLanguageFeature": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "enum": [
            "contextReceivers"
          ]
        }
      ]
    },
    "androidSettings": {
      "type": "object",
      "properties": {
        "compileSdkVersion": {
          "$ref": "#/$defs/androidApiVersion"
        },
        "minSdkVersion": {
          "$ref": "#/$defs/androidSdkVersion"
        },
        "sourceCompatibility": {
          "$ref": "#/$defs/javaVersion"
        },
        "targetCompatibility": {
          "$ref": "#/$defs/javaVersion"
        }
      },
      "additionalProperties": false
    },
    "androidApiVersion": {
      "$comment": "Patterns are taken from com.android.build.gradle.internal.utils.SdkUtils",
      "anyOf": [
        {
          "typeOf": "string",
          "pattern": "^android-([0-9]+)(-ext(\\d+))?$"
        },
        {
          "typeOf": "string",
          "pattern": "^android-([A-Z][0-9A-Za-z_]*)$"
        },
        {
          "typeOf": "string",
          "pattern": "^(.+):(.+):(\\d+)$"
        }
      ]
    },
    "androidSdkVersion": {
      "type": "integer",
      "minimum": 1,
      "maximum": 33
    },
    "publishingSettings": {
      "type": "object",
      "properties": {
        "group": {
          "type": "string"
        },
        "version": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "junitSettings": {
      "type": "object",
      "properties": {
        "platformEnabled": {
          "type": "boolean"
        }
      },
      "additionalProperties": false
    }
  }
}
