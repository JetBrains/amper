{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "CommonDeftSchema.json",
  "title": "Common Deft DSL",
  "type": "object",
  "$defs": {
    "DeftSchema": {
      "properties": {
        "pot": {
          "type": "object",
          "properties": {
            "layout": {
              "type": "string"
            }
          }
        },
        "aliases": {
          "type": "array",
          "patternProperties": {
            "^[^@+:]+$": {
              "$ref": "#/$defs/platformList"
            }
          }
        },
        "variants": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            ]
          }
        },
        "repositories": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/repository"
          }
        }
      },
      "patternProperties": {
        "^(test-)?dependencies(@.+)?$": {
          "$ref": "#/$defs/dependencyList"
        },
        "^(test-)?settings(@.+)?$": {
          "$ref": "#/$defs/settings"
        }
      },
      "additionalProperties": false
    },
    "platform": {
      "enum": [
        "jvm",
        "android",
        "linuxX64",
        "linuxArm64",
        "macosX64",
        "macosArm64",
        "iosArm64",
        "iosX64",
        "iosSimulatorArm64"
      ]
    },
    "platformList": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "$ref": "#/$defs/platform"
      }
    },
    "dependency": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "$ref": "#/$defs/dependencyObject"
        }
      ]
    },
    "dependencyObject": {
      "type": "object",
      "patternProperties": {
        "^.*$": {
          "anyOf": [
            {
              "enum": [
                "exported",
                "compile-only",
                "runtime-only"
              ]
            },
            {
              "type": "object",
              "properties": {
                "scope": {
                  "enum": [
                    "all",
                    "compile-only",
                    "runtime-only"
                  ]
                },
                "exported": {
                  "type": "boolean"
                }
              }
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "dependencyList": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "$ref": "#/$defs/dependency"
      }
    },
    "settings": {
      "type": "object",
      "properties": {
        "kotlin": {
          "$ref": "#/$defs/kotlinSettings"
        },
        "java": {
          "$ref": "#/$defs/javaSettings"
        },
        "android": {
          "$ref": "#/$defs/androidSettings"
        },
        "publishing": {
          "$ref": "#/$defs/publishingSettings"
        },
        "junit": {
          "$ref": "#/$defs/junitSettings"
        },
        "compose": {
          "$ref": "#/$defs/composeSettings"
        }
      },
      "additionalProperties": false
    },
    "javaSettings": {
      "type": "object",
      "properties": {
        "mainClass": {
          "type": "string"
        },
        "packagePrefix": {
          "type": "string"
        },
        "target": {
          "$ref": "#/$defs/kotlinJvmVersion"
        },
        "source": {
          "$ref": "#/$defs/kotlinJvmVersion"
        }
      },
      "additionalProperties": false
    },
    "javaVersion": {
      "$comment": "This version is mapped to org.gradle.api.JavaVersion",
      "$comment": "Not using 'integer' with range for proper completion in IntelliJ",
      "enum": [
        1.1,
        1.2,
        1.3,
        1.4,
        1.5,
        1.6,
        1.7,
        1.8,
        1.9,
        1.10,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24
      ]
    },
    "kotlinJvmVersion": {
      "$comment": "This version is mapped to org.jetbrains.kotlin.gradle.dsl.JvmTarget, so it contains only JVM version compatible with Kotlin compiler",
      "$comment": "Not using 'integer' with range for proper completion in IntelliJ",
      "enum": [
        1.8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19
      ]
    },
    "kotlinSettings": {
      "type": "object",
      "properties": {
        "languageVersion": {
          "$ref": "#/$defs/kotlinVersion"
        },
        "apiVersion": {
          "$ref": "#/$defs/kotlinVersion"
        },
        "allWarningsAsError": {
          "type": "boolean"
        },
        "suppressWarnings": {
          "type": "boolean"
        },
        "verbose": {
          "type": "boolean"
        },
        "debug": {
          "type": "boolean"
        },
        "progressiveMode": {
          "type": "boolean"
        },
        "languageFeatures": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/kotlinLanguageFeature"
          }
        },
        "optIns": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "freeCompilerArgs": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "serialization": {
          "anyOf": [
            {
              "type": "object",
              "properties": {
                "engine": {
                  "enum": [
                    "json",
                    "none"
                  ]
                }
              },
              "additionalProperties": false
            },
            {
              "enum": [
                "json",
                "none"
              ]
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "kotlinVersion": {
      "enum": [
        1.4,
        1.5,
        1.6,
        1.7,
        1.8,
        1.9,
        2.0
      ]
    },
    "kotlinLanguageFeature": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "enum": [
            "contextReceivers"
          ]
        }
      ]
    },
    "androidSettings": {
      "type": "object",
      "properties": {
        "compileSdkVersion": {
          "$ref": "#/$defs/androidApiVersion"
        },
        "minSdk": {
          "$ref": "#/$defs/androidSdkVersion"
        },
        "minSdkPreview": {
          "$ref": "#/$defs/androidSdkVersion"
        },
        "maxSdk": {
          "$ref": "#/$defs/androidSdkIntegerVersion"
        },
        "targetSdk": {
          "$ref": "#/$defs/androidSdkVersion"
        },
        "applicationId": {
          "type": "string"
        },
        "namespace": {
          "type": "string"
        }
      },
      "anyOf": [
        {
          "oneOf": [
            {
              "required": [
                "minSdk"
              ]
            },
            {
              "required": [
                "minSdkPreview"
              ]
            }
          ]
        },
        {
          "not": {
            "required": [
              "minSdk",
              "minSdkPreview"
            ]
          }
        }
      ],
      "additionalProperties": false
    },
    "androidApiVersion": {
      "$comment": "Patterns are taken from com.android.build.gradle.internal.utils.SdkUtils",
      "anyOf": [
        {
          "typeOf": "string",
          "pattern": "^android-([0-9]+)(-ext(\\d+))?$"
        },
        {
          "typeOf": "string",
          "pattern": "^android-([A-Z][0-9A-Za-z_]*)$"
        },
        {
          "typeOf": "string",
          "pattern": "^(.+):(.+):(\\d+)$"
        },
        {
          "enum": [
            "android-34",
            "android-33",
            "android-32",
            "android-31",
            "android-30",
            "android-29",
            "android-28",
            "android-27",
            "android-26"
          ]
        }
      ]
    },
    "androidSdkIntegerVersion": {
      "anyOf": [
        {
          "type": "integer",
          "minimum": 1
        },
        {
          "enum": [
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9,
            10,
            11,
            12,
            13,
            14,
            15,
            16,
            17,
            18,
            19,
            20,
            21,
            22,
            23,
            24,
            25,
            26,
            27,
            28,
            29,
            30,
            31,
            32,
            33,
            34
          ]
        }
      ]
    },
    "androidSdkVersion": {
      "anyOf": [
        {
          "$ref": "#/$defs/androidSdkIntegerVersion"
        },
        {
          "enum": [
            "UPSIDE_DOWN_CAKE",
            "TIRAMISU",
            "S_V2",
            "S",
            "R",
            "Q",
            "P",
            "O_MR1",
            "O",
            "N_MR1",
            "N",
            "M",
            "LOLLIPOP_MR1",
            "LOLLIPOP",
            "KITKAT_WATCH",
            "KITKAT",
            "JELLY_BEAN_MR2",
            "JELLY_BEAN_MR1",
            "JELLY_BEAN",
            "ICE_CREAM_SANDWICH_MR1",
            "ICE_CREAM_SANDWICH",
            "HONEYCOMB_MR2",
            "HONEYCOMB_MR1",
            "HONEYCOMB",
            "GINGERBREAD_MR1",
            "GINGERBREAD",
            "FROYO",
            "ECLAIR_MR1",
            "ECLAIR_0_1",
            "ECLAIR",
            "DONUT",
            "CUPCAKE",
            "BASE_1_1",
            "BASE"
          ]
        },
        {
          "type": "string"
        }
      ]
    },
    "publishingSettings": {
      "type": "object",
      "properties": {
        "group": {
          "type": "string"
        },
        "version": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "junitSettings": {
      "type": "object",
      "properties": {
        "platformEnabled": {
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "composeSettings": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "repository": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "id": {
              "type": "string"
            },
            "url": {
              "type": "string"
            },
            "publish": {
              "type": "boolean"
            },
            "credentials": {
              "type": "object",
              "properties": {
                "file": {
                  "type": "string"
                },
                "usernameKey": {
                  "type": "string"
                },
                "passwordKey": {
                  "type": "string"
                }
              }
            }
          },
          "additionalProperties": false,
          "required": [
            "id",
            "url"
          ]
        },
        {
          "type": "string"
        }
      ]
    }
  }
}
